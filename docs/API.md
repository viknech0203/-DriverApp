# Документация по API DriverApp

## Получение адреса подключения к серверу

Для получения адреса подключения к серверу API необходимо отправить запрос:

POST https://app.atp-online.ru/driver_app/get_host.php



**Тело запроса:**
```json
{
  "inn": "422201084400"
}
Где inn — ИНН организации, введённый пользователем при авторизации.

Пример ответа:

json
Копировать
Редактировать
{
  "host": "87.103.198.92",
  "port": 8080,
  "is_ssl_port": 0
}
Если is_ssl_port = 1, то используем https, иначе http.

Если port = 0, то подключение невозможно. Необходимо выдать сообщение "Обратитесь к системному администратору организации".

Авторизация
URL: /api/v1/driver_mode/auth
Метод: POST

Тело запроса:


{
  "user": "2",
  "password": "2"
}
Ответ:


{
  "token": "<access_token>",
  "refresh": "<refresh_token>"
}
Для последующих запросов необходимо использовать заголовок:

makefile
Копировать
Редактировать
Authorization: Bearer <token>
Обновление токена:
Если access-токен просрочен, используем refresh-токен для получения нового:

Пример ошибки:


{
  "status": {
    "code": -3,
    "text": "Не верный или истекший токен"
  }
}
Получение информации о водителе и рейсе
URL: /api/v1/driver_mode/get_info
Метод: POST
Тело запроса:


{}
Пример ответа: (сокращено, см. полный ответ в исходнике)

Получение справочника статусов
URL: /api/v1/driver_mode/get_status_dir
Метод: POST

Запрос:


{}
Ответ:


{
  "status_dir": [
    { "status_id": "1", "name": "Выезд на линию" },
    ...
  ]
}
Получение списка уже отправленных статусов
URL: /api/v1/driver_mode/get_status
Запрос:


{
  "razn_zak_id": "318854"
}
Ответ: список статусов с vol, stamp, text.

Отправка нового статуса
URL: /api/v1/driver_mode/set_status
Тело запроса:


{
  "apply_stamp_status": "2025-04-14 13:00:00",
  "info": "Тест",
  "status_id": "6",
  "razn_id": "1080570",
  "vol": "3",
  "client_id": "204"
}
Ответ:

{
  "status": {
    "code": 0,
    "text": "ok"
  }
}
Чат
Получение списка сообщений
URL: /api/v1/driver_mode/get_chat
Запрос:


{}
Ответ: массив сообщений (driver_chat_key, stamp, chat_msg, autor)

Отправка сообщения
URL: /api/v1/driver_mode/set_chat
Запрос:


{
  "msg": "текст сообщения"
}
Ответ: весь обновлённый список сообщений.